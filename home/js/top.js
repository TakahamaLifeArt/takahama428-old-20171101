$(function(){function replaceTwTimeStr(time){var tArray=time.split(" ");var timeStr=tArray[0]+" "+tArray[1]+" "+tArray[2]+" "+tArray[5]+" "+tArray[3]+" "+tArray[4];return timeStr;}$('#mainvisual .fl div:first').cycle({auto:true,pause:5000,speed:1500,pager:'#nav'});$('#contact ul li.firstli').hover(function(){$('img',this).stop(true,true).animate({'opacity':'0.6'},500);},function(){$('img',this).stop(true,true).animate({'opacity':'1'},500);});jQuery.extend({init:function(){var dt=new Date();$.prop.schedule_date=dt.getFullYear()+"/"+(dt.getMonth()+1)+"/"+dt.getDate();$.calcEstimation();},prop:{'schedule_date':"",'t-shirts':[0,0,0],'polo-shirts':[0,0,0],'sportswear':[0,0,0],'sweat':[0,0,0]},getDeliveryDays:function(transport,mode,idx){var res=["","",""];var base=$.prop.schedule_date;base=Date.parse(base)/1000;var postData={'act':'deliverydays','base':base,'transport':transport,'mode':mode};$.ajax({url:'/php_libs/orders.php',type:'post',dataType:'json',async:false,data:postData,success:function(r){var targetSec=Date.parse(r[idx]);var dt=new Date();dt.setTime(targetSec);res[0]=(dt.getMonth()+1);res[1]=dt.getDate();res[2]=r[4];res[3]=r[5];}});return res;},showDeliveryDate:function(idx){var d=$.getDeliveryDays(1,'simple',idx);$('.trans01','#deliveryday').text(d[0]+"/"+d[1]);d=$.getDeliveryDays(2,'simple',idx);$('.trans02','#deliveryday').text(d[0]+"/"+d[1]);if(idx!=3){$('#time_limit').text("13");$('#deliveryday .tokyo').hide();}else{$('#time_limit').text("11");var targetSec=Date.parse(d[3]);var dt=new Date();dt.setTime(targetSec);$('.trans00','#deliveryday').text((dt.getMonth()+1)+"/"+dt.getDate());$('#deliveryday .tokyo').show();}},calcEstimation:function(){var categoryKey=$('#item_id input[name="type"]:checked').attr('class');var itemID=$('#item_id input[name="type"]:checked').val();var inkCount=$('#ink_count input[name="inks"]:checked').val();var amount=$('#jquery-ui-slider-value').val()-0;var position=1;var massIndex=0;if(amount>149){if(amount<300){massIndex=1;}else{massIndex=2;}}var itemCost=$.prop[categoryKey][massIndex];var args=[];args[0]={"itemid":itemID,"ink":inkCount,"amount":amount,"pos":position};var prm={'act':'printfee','output':'jsonp','sheetsize':'1','args':args};$.getJSON($.TLA.api+'?callback=?',prm,function(r){if(!itemCost){var postData={'act':'price','output':'jsonp','itemid':itemID,'amount':amount};$.getJSON($.TLA.api+'?callback=?',postData,function(a){itemCost=a[0]['price_white'];$.prop[categoryKey][massIndex]=a[0]['price_white'];var base=itemCost*amount+r.printfee;var tax=Math.floor(base*(r.tax/100));var sum=Math.floor(base*(1+r.tax/100));$('#sum').val($.addFigure(sum));var per=Math.ceil(sum/amount);$('#per').val($.addFigure(per));});}else{var base=itemCost*amount+r.printfee;var tax=Math.floor(base*(r.tax/100));var sum=Math.floor(base*(1+r.tax/100));$('#sum').val($.addFigure(sum));var per=Math.ceil(sum/amount);$('#per').val($.addFigure(per));}});}});$("#plan_link").click(function(){$('.plan').hide();$(".deliveryarea").fadeIn(2000);});$('#deliveryday').on('change',':radio[name="plan"]',function(){$.showDeliveryDate($(this).val());});$('.icon_cross').click(function(){$('.deliveryarea').hide();$(".plan").fadeIn(2000);});$('#item_id :radio[name="type"], #ink_count :radio[name="inks"]').change(function(){$.calcEstimation();});$("#rankingtab li").click(function(){var num=$("#rankingtab li").index(this);$(".ranking_wrap").addClass('disnon');$(".ranking_wrap").eq(num).removeClass('disnon');$("#rankingtab li").removeClass('select');$(this).addClass('select');});$.datepicker.regional['ja']={closeText:'閉じる',prevText:'<前',nextText:'次>',currentText:'今日',monthNames:['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月'],monthNamesShort:['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月'],dayNames:['日曜日','月曜日','火曜日','水曜日','木曜日','金曜日','土曜日'],dayNamesShort:['日','月','火','水','木','金','土'],dayNamesMin:['日','月','火','水','木','金','土'],weekHeader:'週',dateFormat:'yy/mm/dd',firstDay:0,isRTL:false,showMonthAfterYear:true,yearSuffix:'年'};$.datepicker.setDefaults($.datepicker.regional['ja']);$("#datepicker").datepicker({onSelect:function(dateText,inst){$.prop.schedule_date=dateText.replace(/-/g,'/');var targetSec=Date.parse(dateText);var dt=new Date();dt.setTime(targetSec);var month=(dt.getMonth()+1);var day=dt.getDate();var weekname=["日","月","火","水","木","金","土"];var week=weekname[dt.getDay()];$('#deliveryday .otodoke .month').text(month);$('#deliveryday .otodoke .day').text(day);$('#deliveryday .otodoke .week').text(week);$.showDeliveryDate($(':radio[name="plan"]:checked','#deliveryday').val());}});$('#jquery-ui-slider').slider({range:'min',value:30,min:0,max:300,step:10,slide:function(event,ui){$('#jquery-ui-slider-value').val(ui.value);},stop:function(event,ui){$.calcEstimation();}});$('#jquery-ui-slider-value').val($('#jquery-ui-slider').slider('value'));$("#jquery-ui-slider-value").change(function(){$("#jquery-ui-slider").slider("value",$(this).val());$.calcEstimation();});$.init();});